version: '3.9'

services:
  # 1. Dịch vụ Backend (Spring Boot) - ĐÃ CẬP NHẬT
  backend-app:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: cafe-backend
    ports:
      - "8081:8080" # Giữ nguyên port 8081 của bạn
    environment:
      # --- CÁC BIẾN MÔI TRƯỜNG MỚI CHO application.properties ---
      - DB_PASSWORD=${DB_PASSWORD}
      - AWS_REGION=${AWS_REGION}
      - AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}
      
      # ⚠️ SỬA 2 DÒNG NÀY ⚠️
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      
    # --- CÁC BIẾN CŨ (ĐÃ XÓA) ---
    # SPRING_DATASOURCE_* đã bị xóa vì Spring tự đọc từ application.properties
    # APP_UPLOAD_DIR đã bị xóa
    
    # --- VOLUME (ĐÃ XÓA) ---
    # volumes: - uploads-data:/app/uploads (Không cần nữa vì dùng S3)

  # 2. Dịch vụ Frontend (React) - GIỮ NGUYÊN
  frontend-app:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: cafe-frontend
    ports:
      - "3000:80"
    depends_on:
      - backend-app

# Định nghĩa volumes (ĐÃ XÓA)
# volumes:
#  uploads-data: {}
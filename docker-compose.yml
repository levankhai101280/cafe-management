version: '3.9'

services:
  # 1. Dịch vụ Backend (Spring Boot)
  backend-app:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: cafe-backend
    ports:
      - "8081:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://cafe-management-db.cgxuk446ys3r.us-east-1.rds.amazonaws.com:3306/cafe-management-db?serverTimezone=UTC
      SPRING_DATASOURCE_USERNAME: admin
      SPRING_DATASOURCE_PASSWORD: 0931643765
      SPRING_JPA_HIBERNATE_DDL_AUTO: update
      APP_UPLOAD_DIR: uploads
    volumes:
      - uploads-data:/app/uploads

  # 2. Dịch vụ Frontend (React)
  frontend-app:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: cafe-frontend
    ports:
      - "3000:80"
    depends_on:
      - backend-app

# Định nghĩa volumes
volumes:
  uploads-data: {}
